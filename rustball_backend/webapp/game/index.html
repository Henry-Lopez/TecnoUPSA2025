<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>RustBall â€“ Bevy WASM</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Trunk insertarÃ¡ automÃ¡ticamente el script rustball-<hash>.js con Wasm -->
  <!-- (no necesitamos bootstrap.js)                                          -->

  <!-- Copiar recursivamente la carpeta assets/ al dist/assets -------------- -->
  

  <style>
    html,body{
      margin:0;padding:0;height:100%;background:#121212;
      display:flex;flex-direction:column;align-items:center;justify-content:center
    }
    #start-message{
      color:#fff;font-family:sans-serif;font-size:18px;
      margin-bottom:20px;user-select:none
    }
    canvas{
      border:3px solid #ffffff20;border-radius:12px;
      max-width:100%;max-height:100%
    }
  </style>
<link rel="modulepreload" href="/game/rustball.js" crossorigin="anonymous" integrity="sha384-nuZG8vz82c7PWMBcO3q3QyRtjGqxsH0bBPakpp2hYy/7Sbx4dI1hjbvdgD9HRscI"><link rel="preload" href="/game/rustball_bg.wasm" crossorigin="anonymous" integrity="sha384-TizIsXwhuo6K3BuTtWhYUfpZhFxIY/+XCgYJW5yki/g+vEK1KlOhxQMYgPWSx3Uq" as="fetch" type="application/wasm"></head>

<body>
<!-- Mensaje inicial ------------------------------------------------------ -->
<div id="start-message">âš½ Haz clic para iniciar RustBall</div>

<!-- Espera a que Trunk cargue Wasm y exponga window.wasmBindings --------- -->
<script type="module">
  addEventListener("TrunkApplicationStarted", () => {
    const { start_game } = window.wasmBindings;      // exportada en Rust
    const pid = Number(localStorage.getItem("rb_pid") || 0);
    const uid = Number(localStorage.getItem("rb_uid") || 0);
    console.log("ðŸŽ® Juego iniciado â€“ partida:", pid, "usuario:", uid);
    start_game(pid, uid);                            // arranca Bevy
  });
</script>

<!-- Primer clic: oculta mensaje, enfoca canvas y reanuda audio ---------- -->
<script>
  document.addEventListener("click", () => {
    /* Ocultar texto de inicio */
    document.getElementById("start-message")?.remove();

    /* Espera un frame â†’ Bevy crea su canvas â†’ enfÃ³calo */
    requestAnimationFrame(() => {
      const c = document.querySelector("canvas");
      if (c){ c.setAttribute("tabindex","0"); c.focus(); }
    });

    /* Reactivar AudioContext suspendido por el navegador */
    try {
      const AC = window.AudioContext || window.webkitAudioContext;
      if (AC){
        const ctx = new AC();
        if (ctx.state === "suspended") ctx.resume();
      }
    } catch (_) { /* ignorar */ }
  }, { once:true });
</script>

<script type="module">
import init, * as bindings from '/game/rustball.js';
const wasm = await init({ module_or_path: '/game/rustball_bg.wasm' });


window.wasmBindings = bindings;


dispatchEvent(new CustomEvent("TrunkApplicationStarted", {detail: {wasm}}));

</script></body>
</html>